<template>
  <div class="tech-container">
    <!-- <h1 class="title">å‘å¸ƒåšå®¢</h1> -->

    <!-- <section class="tech-block">
      <h2>ğŸŒ å‰ç«¯æŠ€æœ¯</h2>
      <ul>
        <li><strong>HTML5 + CSS3</strong>ï¼šæŒæ¡è¯­ä¹‰åŒ–æ ‡ç­¾ã€Flex å¸ƒå±€ã€å“åº”å¼è®¾è®¡ã€‚</li>
        <li><strong>JavaScript</strong>ï¼šç†Ÿæ‚‰ ES6+ è¯­æ³•ã€äº‹ä»¶å¤„ç†ã€DOM æ“ä½œã€å¼‚æ­¥ç¼–ç¨‹ï¼ˆPromiseã€async/awaitï¼‰ã€‚</li>
        <li><strong>Vue3 + TypeScript</strong>ï¼šä½¿ç”¨ Composition APIã€refã€reactiveã€ç»„ä»¶é€šä¿¡ã€Pinia çŠ¶æ€ç®¡ç†ã€‚</li>
        <li><strong>Axios</strong>ï¼šè¿›è¡Œ HTTP è¯·æ±‚å°è£…ä¸é”™è¯¯å¤„ç†ã€‚</li>
        <li><strong>TailwindCSS</strong>ï¼šå¿«é€Ÿæ„å»ºç¾è§‚ UIï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚</li>
      </ul>
    </section>

    <section class="tech-block">
      <h2>ğŸ› ï¸ åç«¯æŠ€æœ¯</h2>
      <ul>
        <li><strong>Spring Boot</strong>ï¼šæ­å»º RESTful APIï¼Œæ•´åˆ MyBatisã€Spring MVCã€‚</li>
        <li><strong>MyBatis + MySQL</strong>ï¼šç†Ÿæ‚‰ CRUDã€åŠ¨æ€ SQLã€åˆ†é¡µæŸ¥è¯¢ã€è¡¨å…³è”ã€‚</li>
        <li><strong>Spring Security</strong>ï¼šå®ç°ç”¨æˆ·è®¤è¯ä¸æƒé™æ§åˆ¶ã€‚</li>
        <li><strong>JWT</strong>ï¼šå®ç°æ— çŠ¶æ€ç™»å½•æœºåˆ¶ã€‚</li>
      </ul>
    </section>

    <section class="tech-block">
      <h2>ğŸ“¦ é¡¹ç›®ç®¡ç† & éƒ¨ç½²</h2>
      <ul>
        <li><strong>Git</strong>ï¼šç‰ˆæœ¬æ§åˆ¶ã€åˆ†æ”¯ç®¡ç†ã€åä½œå¼€å‘ã€‚</li>
        <li><strong>Vite</strong>ï¼šå‰ç«¯é¡¹ç›®æ„å»ºå·¥å…·ï¼Œé…åˆ Vue3 ä½¿ç”¨ã€‚</li>
        <li><strong>Nginx + é˜¿é‡Œäº‘æœåŠ¡å™¨</strong>ï¼šéƒ¨ç½²å‰åç«¯é¡¹ç›®ã€é…ç½® SSL è¯ä¹¦ã€åŸŸåç»‘å®šã€‚</li>
      </ul>
    </section>

    <section class="tech-block">
      <h2>ğŸ“š å…¶ä»–æŠ€æœ¯ & å®è·µ</h2>
      <ul>
        <li><strong>å¾®ä¿¡å°ç¨‹åº</strong>ï¼šå®Œæˆè™šæ‹Ÿè¯•è¡£é—´åŠŸèƒ½ï¼Œæ¥å…¥æŠ å›¾ APIã€åˆæˆæ¥å£ã€‚</li>
        <li><strong>AI åº”ç”¨</strong>ï¼šè°ƒç”¨ç™¾ç‚¼ APIï¼Œå®ç°å›¾æ–‡ç”ŸæˆåŠŸèƒ½ã€‚</li>
        <li><strong>ESP8266 + å•ç‰‡æœº</strong>ï¼šä¸²å£é€šä¿¡ï¼Œæ§åˆ¶ LED ç¯ï¼Œå®ç°å°ç¨‹åºè¿œç¨‹æ§åˆ¶ã€‚</li>
        <li><strong>è½¯è‘— & é¡¹ç›®æ±‡æŠ¥</strong>ï¼šå…·å¤‡é¡¹ç›®æ€»ç»“ã€æ–‡æ¡£æ’°å†™ã€PPT æ¼”ç¤ºèƒ½åŠ›ã€‚</li>
      </ul>
    </section> -->
     <BolgEdit />

    <div class="upload">
      <h2 style="color: red;">ä¸Šä¼ æ–‡ä»¶</h2>
      <input type="file" style="color: rgb(72, 63, 63);" @change="handleFileChange" />
      <select v-model="fileType">
        <option value="image">å›¾ç‰‡</option>
        <option value="video">è§†é¢‘</option>
        <option value="blog">åšå®¢æ–‡æ¡£</option>
        <option value="zip">å‹ç¼©åŒ…</option>
      </select>
      <button @click="uploadFile">ä¸Šä¼ </button>
      <p v-if="message">{{ message }}</p>
    </div>

    <div class="file-view">
      <h2 style="color: red;">æˆ‘çš„æ–‡ä»¶</h2>
      <div class="tabs">
        <button @click="loadFiles('image')">å›¾ç‰‡</button>
        <button @click="loadFiles('video')">è§†é¢‘</button>
        <button @click="loadFiles('blog')">åšå®¢</button>
        <button @click="loadFiles('zip')">å‹ç¼©åŒ…</button>
      </div>

      <div v-if="fileType === 'image'" class="image-list">
        <div v-for="file in files" :key="file.url" class="file-card">
          <img :src="getUrl(file.url)" :alt="file.name" width="200" />
          <p>{{ file.name }}</p>
          <a :href="getUrl(file.url)" download>ä¸‹è½½</a>
        </div>
      </div>

      <div v-else-if="fileType === 'video'" class="video-list">
        <div v-for="file in files" :key="file.url" class="file-card">
          <video :src="getUrl(file.url)" controls width="400"></video>
          <p>{{ file.name }}</p>
          <a :href="getUrl(file.url)" download>ä¸‹è½½</a>
        </div>
      </div>

      <ul v-else>
        <li v-for="file in files" :key="file.url">
          <a :href="getUrl(file.url)" target="_blank">{{ file.name }}</a>
          <a :href="getUrl(file.url)" download style="margin-left: 10px;">ä¸‹è½½</a>
        </li>
      </ul>
    </div>
  </div>
</template>

<script setup lang="ts">
import BolgEdit from '@/components/bolgEdit.vue'

import { ref } from 'vue'
import { useRouter } from 'vue-router'
import { useAuthStore } from '@/stores/auth'
import axios from '@/api'

const authStore = useAuthStore()
const router = useRouter()

const files = ref<{ name: string; url: string }[]>([])
const selectedFile = ref<File | null>(null)
const fileType = ref('image')
const message = ref('')
const uploadUrl = ref('')

const handleLogout = () => {
  authStore.clearAuth()
  router.push('/login')
}

const handleFileChange = (e: Event) => {
  const target = e.target as HTMLInputElement
  if (target.files && target.files.length > 0) {
    selectedFile.value = target.files[0]
  }
}

const uploadFile = async () => {
  if (!selectedFile.value) {
    message.value = 'è¯·å…ˆé€‰æ‹©æ–‡ä»¶'
    return
  }

  const formData = new FormData()
  formData.append('file', selectedFile.value)
  formData.append('userId', authStore.userId || '')
  formData.append('fileType', fileType.value)

  try {
    const res = await axios.post('/upload/userfile', formData, {
      headers: { 'Content-Type': 'multipart/form-data' }
    })
    message.value = res.data
    uploadUrl.value = '' // ä¸Šä¼ æˆåŠŸåä¸ç«‹å³é¢„è§ˆ
    loadFiles(fileType.value) // è‡ªåŠ¨åˆ·æ–°åˆ—è¡¨
  } catch (error) {
    console.error('ä¸Šä¼ å¤±è´¥', error)
    message.value = 'ä¸Šä¼ å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–æœåŠ¡å™¨'
  }
}

const loadFiles = async (type: string) => {
  fileType.value = type
  const res = await axios.get('/user/files', {
    params: { userId: authStore.userId, fileType: type }
  })
  files.value = res.data
}

const getUrl = (url: string) => {
  return url.startsWith('http') ? url : '/' + url
}
</script>

<style scoped>
.user-home {
  margin: 100px auto;
  max-width: 500px;
  display: flex;
  flex-direction: column;
  gap: 20px;
}
.upload-section {
  margin-top: 20px;
}
/* .input[type="file"] {
  margin-bottom: 10px;
  color: rgb(72, 63, 63);
} */
.upload-section input[type="file"] {
  margin-bottom: 10px;
  color: rgb(72, 63, 63);
}
.upload {
  max-width: 400px;
  margin: 50px auto;
  display: flex;
  flex-direction: column;
  gap: 10px;
}
.tabs {
  display: flex;
  gap: 10px;
  margin-bottom: 16px;
}
.image-list,
.video-list {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
}
.file-card {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
  /* color: rgb(72, 63, 63); */
}
.file-view {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
  /* color: rgb(72, 63, 63); */
}

</style>


<style scoped>
.tech-container {
  max-width: 960px;
  margin: 0 auto;
  padding: 40px 16px;
}
.title {
  font-size: 2.25rem;
  font-weight: bold;
  text-align: center;
  margin-bottom: 40px;
  color: #1e293b;
}
.tech-block {
  margin-bottom: 32px;
  background: #f8fafc;
  padding: 24px;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.04);
}
.tech-block h2 {
  font-size: 1.5rem;
  margin-bottom: 16px;
  color: #2563eb;
}
.tech-block ul {
  list-style-type: disc;
  padding-left: 20px;
}
.tech-block li {
  margin-bottom: 8px;
  line-height: 1.6;
}
</style>

